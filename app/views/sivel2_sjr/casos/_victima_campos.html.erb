<div class='control-group nested-fields'>
  <div class="controls">
    <br>
    <h5>DATOS BÁSICOS DEL MIEMBRO DEL GRUPO FAMILIAR</h5>
    <% if f.object.persona.nil?
        f.object.persona = Sip::Persona.new(nombres: '')
        f.object.victimasjr = Sivel2Sjr::Victimasjr.new
       end %>
       
    <%= f.simple_fields_for :victimasjr do |fvictimasjr| %>
      <%= f.simple_fields_for :persona do |fp| %>

      <%= fp.input :id, as: :hidden %>
      <% 
        ph = 'N'
        ac = {'data-autocompleta' => 'no' }
         if (!fp.object.nombres || fp.object.nombres == 'N' || fp.object.nombres == '')
           ph = 'Buscar'
           ac = { }
         end
       %>
      <div class="row">
        <div class="col-md-6">
          <%= fp.input :nombres, placeholder: ph,
            value_method: lambda {|t| '' if t.nombres == 'N'},
            :input_html => ac %>
        </div>
        <div class="col-md-6">
          <%= fp.input :apellidos, placeholder: 'N',
            value_method: lambda {|t| '' if t.apellidos == 'N'} %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <%= fp.input :tdocumento_id,
            collection: Sip::Tdocumento.habilitados,
            label_method: :nombre,
            value_method: :id %>
        </div>
        <div class="col-md-6">
          <%= fp.input :numerodocumento,
            input_html: { 'data-toggle' => 'tooltip',
              title: 'Si el tipo de documento es cédula de ciudadania teclee solo digitos'
          } %>
        </div>
      </div>
      <div class="input string" style="display: none">
        <label class="string control-label">Casos en los que aparece: </label>
        <% 
          r = ""
          sep = ""
          v = Sivel2Gen::Victima.where(id_persona: fp.object.id).order(:id_persona)
          v.each do |vic|
            if @caso.id != vic.caso.id
          %>
          <%= link_to vic.caso.id, sivel2_gen.caso_path(vic.caso), target:"_blank" %> 
          <% 
            end
          end 
        %>
      </div>

      <% @meses = [
        ["ENERO", 1], 
        ["FEBRERO", 2], 
        ["MARZO", 3], 
        ["ABRIL", 4], 
        ["MAYO", 5], 
        ["JUNIO", 6], 
        ["JULIO", 7], 
        ["AGOSTO", 8], 
        ["SEPTIEMBRE", 9], 
        ["OCTUBRE", 10], 
        ["NOVIEMBRE", 11], 
        ["DICIEMBRE", 12]] %>
      <% @dias = *(1..31) %>


      <div class="row">
        <div class="col-md-4">
          <%= render partial: 'sip/personas/campo_sexo', locals: {f: fp} %>
        </div>
      </div>
    
      <div class="row">
        <div class="col-md-6">
          <% @anios = *(1900..Date.today.year) %>
          <%= fp.input :anionac, 
            collection: @anios %>
        </div>
        <div class="col-md-6">
          <%= f.input :edad, as: :integer %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <%= fp.input :mesnac, collection: @meses %>
        </div>
        <div class="col-sm-6">
          <%= f.association :rangoedad,
            collection: Sivel2Gen::Rangoedad.habilitados(:rango),
            include_blank: false,
            label_method: :rango, 
            value_method: :id 
          %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <%= fp.input :dianac, collection: @dias %>
        </div>
        <div class="col-md-6">
          <%= f.input :edadactual, as: :hidden %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <%= fp.association :pais,
            collection: Sip::Pais.habilitados,
            label_method: :nombre,
            value_method: :id %>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <%= fp.association :departamento,
            collection: (Sip::Departamento.habilitados.where(
              id_pais: fp.object.id_pais)),
              label_method: :nombre,
              value_method: :id %>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <%= fp.association :municipio, 
            collection: (Sip::Municipio.habilitados.
                         where(id_departamento: fp.object.id_departamento)), 
            label_method: :nombre, value_method: :id %>
        </div>
        <div class="col-md-6">
          <%= fp.association :clase,
            collection: (Sip::Clase.habilitados.where(
              id_municipio: fp.object.id_municipio)),
              as: :hidden,
              label_method: :nombre,
              value_method: :id %>
        </div>
      </div>

      <%= render partial: 'sip/personas/familiar', locals: {f: fp} %>
    </div>

    <br>
    <h5>ANEXOS</h5>
    <div class="row">
    </div>
    <br>
    <h5>DATOS AMPLIOS DEL MIEMBRO DEL GRUPO FAMILIAR</h5>
        <% [2,4,5,1].each do |i| %>
          <%= render partial: 'victima_campos' + i.to_s, 
            locals: { victima: f, 
                      victimasjr: fvictimasjr,
                      persona: fp }
          %>
        <% end %>
  
    <br>
    <h5>GESTIÓN DEL MIEMBRO</h5>
        <%= fvictimasjr.input :fechadesagregacion, 
          input_html: { 
            "data-behaviour" => "datepicker",
            "data-toggle" => 'tooltip',
            title: 'Sólo se llena si la persona sale del grupo familiar y se registra la fecha en la que salió del grupo familiar (sin eliminar a la persona del grupo familiar que queda como información histórica)'
          },
          as: :string, 
          label: "Fecha de Desagregación" 
        %>
      <% end %> <!-- simple_fields_for :persona-->
    <% end %> <!-- simple_fields_for :fvictimasjr -->

    <%= link_to_remove_association "Eliminar Víctima", f, 
      {class: 'btn-danger', :'data-existing' => 'true'} %> 
  </div>
</div>
